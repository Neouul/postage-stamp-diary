# 우표 수집 다이어리 (Stamp Collector) 기술 개발 계획서

본 계획서는 Jetpack Compose, Navigation3, MVVM 아키텍처 및 Result 패턴을 활용한 안드로이드 네이티브 앱 구현을 위한 가이드입니다.

## 1. 아키텍처 설계 (Architecture Design)

앱의 유지보수성과 확장성을 위해 레이어드 아키텍처를 적용합니다.

### 🏛 아키텍처 계층 구조

- **UI Layer (Jetpack Compose)**: `ViewModel`에서 상태를 구독하고 사용자의 이벤트를 전달합니다.
- **Domain Layer**: 비즈니스 로직(UseCase)을 처리합니다. (필요 시 도입)
- **Data Layer**: `Repository`를 통해 데이터 소스에 접근하며, `Result` 패턴으로 결과를 반환합니다.
    - **Repository**: 데이터의 단일 진입점 역할을 수행합니다.
    - **DataSource**: 로컬 DB(Room) 및 외부 저장소(CameraX) 연동을 담당합니다.

## 2. 기술 스택 세부 사항

| 구분 | 기술 스택 | 비고 |
| --- | --- | --- |
| **UI** | Jetpack Compose | 선언형 UI, Navigation3 적용 |
| **Architecture** | MVVM | StateFlow를 이용한 상태 관리 |
| **DI** | Hilt | 의존성 주입을 통한 결합도 감소 |
| **Database** | Room | 우표 메타데이터 및 메모 저장 |
| **Camera** | CameraX | 분석 및 촬영 로직 구현 |
| **Image** | Coil / Canvas API | 이미지 로딩 및 우표 마스킹 처리 |
| **Navigation** | Navigation3 | 최신 컴포즈 전용 내비게이션 라이브러리 |

## 3. 상세 구현 패턴

### ① Result 패턴 (Error Handling)

네트워크나 DB 접근 시 발생할 수 있는 예외를 안전하게 처리하기 위해 공통 `Result` 클래스를 사용합니다.

```kotlin
sealed class Result<out T, out E> {
		data class Success<out T>(val data: T) : Result<T, Nothing>()
		data class Error<out E>(val error: E) : Result<Nothing, E>()
}
```

### ② Data Layer Flow

1. **LocalDataSource**: `StampDao`를 호출하여 우표 데이터를 가져오거나 저장합니다.
2. **Repository**: DataSource의 데이터를 `flow`로 받아 `Result`로 래핑하여 ViewModel로 전달합니다.

### ③ Navigation3 적용

기존의 문자열 기반 라우팅 대신 타입 안정성이 강화된 Navigation3 방식을 채택합니다.

- `StampKey`: `Home`, `Camera`, `Detail(id)` 등 각 화면을 정의하는 고유 키.
- `NavHost`: 현재 스택에 따른 컴포저블 전환 관리.

## 4. 데이터베이스 스키마 (Room)

**StampEntity**

- `id`: Long (PK, AutoIncrement)
- `imagePath`: String (내부 저장소 이미지 경로)
- `frameType`: String (적용된 우표 스타일)
- `memo`: String? (우표 뒷면 메모)
- `createdAt`: Long (날짜/시간 정보)
- `latitude/longitude`: Double (위치 정보)

## 5. 단계별 개발 로드맵

### 1단계: 프로젝트 기반 설정 (Foundation)

- Hilt, Room, Navigation3 의존성 설정.
- Theme(Old Lace, Saddle Brown) 및 Typography 설정.
- `Result` 클래스 및 기본 `BaseViewModel` 작성.

### 2단계: 카메라 및 이미지 처리 (Core Feature)

- CameraX 연동 및 `CameraPreview` 구현.
- Canvas API를 활용한 우표 모양 Path 드로잉 및 비트맵 마스킹 로직 개발.
- 촬영된 이미지를 내부 저장소에 저장하고 경로를 추출하는 `StorageDataSource` 구현.

### 3단계: 앨범 및 상세 보기 (Data Flow)

- `StampRepository` 구현 (Room 연동).
- `LazyVerticalGrid`를 활용한 우표첩 화면 구현.
- Compose Animation을 이용한 Card Flip(우표 앞/뒷면) 효과 적용.

### 4단계: 고도화 및 최적화

- 내보내기 기능(PNG 저장).
- 통계 화면 및 테마 변경 기능 추가.
- UI 테스트 및 엣지 케이스 처리.

## 6. 핵심 인터페이스 예시

```kotlin
interface StampRepository {
    fun getAllStamps(): Flow<Result<List<Stamp>>>
    fun getStampById(id: Long): Flow<Result<Stamp>>
    suspend fun saveStamp(stamp: Stamp): Result<Unit>
}
```